#!/usr/bin/env bash

set -e

nihongo_library_path="/nihongo"
nihongo_folder_path="$HOME/Library/Mobile Documents/27N4MQEA55~pro~writer/Documents$nihongo_library_path"

__nihongo_open () {
  open "$nihongo_folder_path"
}

__nihongo_last () {
  last_file_path=$(find "$nihongo_folder_path" -type f -name "*-practice.md" | sort | tail -n 1)
  last_file_name=$(basename "$last_file_path")
  library_path="$nihongo_library_path/$last_file_name"

  echo "Opening entry for $last_file_name..."
  open "iawriter://open?path=$library_path&edit=true"
}

__nihongo_new () {
  timestamp=$(date "+%Y-%m-%d")
  library_path="$nihongo_library_path/$timestamp-practice.md"

  echo "Creating entry for $timestamp..."
  open "iawriter://new?path=$library_path&edit=true"
}

__nihongo_help () {
  echo -e ""
  echo -e "  Usage: nihongo \e[2m[cmd]\e[0m"
  echo -e ""
  echo "  Commands:"
  echo ""
  echo "    open    Open 日本語 notes folder in Finder"
  echo "    last    Edit the most recent 日本語 notes doc"
  echo "    new     Create a new notes entry"
  echo ""
}

# assert arguments
[ $# -ne 1 ] && __nihongo_help && exit 1

# switch arguments
case $1 in
  o|open) __nihongo_open;;
  l|last) __nihongo_last;;
  n|new) __nihongo_new;;
  -h|--help) __nihongo_help;;
esac
